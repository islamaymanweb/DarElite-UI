<div class="container mx-auto p-6">
  <div class="header-section">
    <div
      class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4"
    >
      <div>
        <h1 class="page-title">Products Management</h1>
        <p class="page-subtitle">Manage your product catalog efficiently</p>
      </div>
      <button (click)="showAddProductForm()" class="action-button">
        <i class="fas fa-plus mr-2"></i>
        Add New Product
      </button>
    </div>
  </div>
  <div *ngIf="showAddForm" class="form-container">
    <h3 class="form-title">Add New Product</h3>
    <form (ngSubmit)="onAddSubmit()" #addForm="ngForm" class="space-y-6">
      <div class="form-grid">
        <div class="form-group">
          <label for="name" class="required">Product Name</label>
          <input
            type="text"
            id="name"
            [(ngModel)]="newProduct.name"
            name="name"
            required
            class="form-input"
            placeholder="Enter product name"
          />
        </div>
        <div class="form-group">
          <label for="categoryId" class="required">Category</label>
          <select
            id="categoryId"
            [(ngModel)]="newProduct.categoryId"
            name="categoryId"
            required
            class="form-input"
          >
            <option value="">Select Category</option>
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="description" class="required">Description</label>
        <textarea
          id="description"
          [(ngModel)]="newProduct.description"
          name="description"
          rows="3"
          required
          class="form-input"
          placeholder="Enter product description"
        ></textarea>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label for="newPrice" class="required">Current Price</label>
          <input
            type="number"
            id="newPrice"
            [(ngModel)]="newProduct.newPrice"
            name="newPrice"
            step="0.01"
            min="0"
            required
            class="form-input"
            placeholder="0.00"
          />
        </div>
        <div class="form-group">
          <label for="oldPrice" class="required">Original Price</label>
          <input
            type="number"
            id="oldPrice"
            [(ngModel)]="newProduct.oldPrice"
            name="oldPrice"
            step="0.01"
            min="0"
            required
            class="form-input"
            placeholder="0.00"
          />
        </div>
      </div>

      <div class="form-group">
        <div class="file-upload">
          <label for="productImages" class="required">Product Images</label>
          <input
            type="file"
            id="productImages"
            (change)="onFileSelected($event)"
            multiple
            accept="image/*"
            required
            class="file-input"
          />
          <p class="file-hint">Select one or multiple images (required)</p>
          <p *ngIf="selectedFiles" class="file-selected">
            <i class="fas fa-check-circle mr-1"></i>
            {{ selectedFiles.length }} file(s) selected
          </p>
        </div>
      </div>

      <div class="button-group">
        <button
          type="submit"
          [disabled]="!addForm.valid || !selectedFiles"
          class="btn-submit"
        >
          <i class="fas fa-check mr-2"></i>
          Add Product
        </button>
        <button type="button" (click)="cancelForms()" class="btn-cancel">
          <i class="fas fa-times mr-2"></i>
          Cancel
        </button>
      </div>
    </form>
  </div>

  <!-- Edit Product Form -->
  <div *ngIf="showEditForm" class="form-container">
    <h3 class="form-title">Edit Product</h3>
    <form (ngSubmit)="onEditSubmit()" #editForm="ngForm" class="space-y-6">
      <div class="form-grid">
        <div class="form-group">
          <label for="editName" class="required">Product Name</label>
          <input
            type="text"
            id="editName"
            [(ngModel)]="editProduct.name"
            name="editName"
            required
            class="form-input"
            placeholder="Enter product name"
          />
        </div>
        <div class="form-group">
          <label for="editCategoryId" class="required">Category</label>
          <select
            id="editCategoryId"
            [(ngModel)]="editProduct.categoryId"
            name="editCategoryId"
            required
            class="form-input"
          >
            <option value="">Select Category</option>
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="editDescription" class="required">Description</label>
        <textarea
          id="editDescription"
          [(ngModel)]="editProduct.description"
          name="editDescription"
          rows="3"
          required
          class="form-input"
          placeholder="Enter product description"
        ></textarea>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label for="editNewPrice" class="required">Current Price</label>
          <input
            type="number"
            id="editNewPrice"
            [(ngModel)]="editProduct.newPrice"
            name="editNewPrice"
            step="0.01"
            min="0"
            required
            class="form-input"
            placeholder="0.00"
          />
        </div>
        <div class="form-group">
          <label for="editOldPrice" class="required">Original Price</label>
          <input
            type="number"
            id="editOldPrice"
            [(ngModel)]="editProduct.oldPrice"
            name="editOldPrice"
            step="0.01"
            min="0"
            required
            class="form-input"
            placeholder="0.00"
          />
        </div>
      </div>

      <div class="form-group">
        <div class="file-upload">
          <label for="editProductImages">New Product Images (Optional)</label>
          <input
            type="file"
            id="editProductImages"
            (change)="onEditFileSelected($event)"
            multiple
            accept="image/*"
            class="file-input"
          />
          <p class="file-hint">Select new images to replace existing ones</p>
          <p *ngIf="editSelectedFiles" class="file-selected">
            <i class="fas fa-check-circle mr-1"></i>
            {{ editSelectedFiles.length }} new file(s) selected
          </p>
        </div>
      </div>

      <div class="button-group">
        <button type="submit" [disabled]="!editForm.valid" class="btn-update">
          <i class="fas fa-save mr-2"></i>
          Update Product
        </button>
        <button type="button" (click)="cancelForms()" class="btn-cancel">
          <i class="fas fa-times mr-2"></i>
          Cancel
        </button>
      </div>
    </form>
  </div>

  <!-- Products Table -->
  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Product Details</th>
          <th>Category</th>
          <th>Pricing</th>
          <th>Images</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of products; trackBy: trackByProductId">
          <td>
            <span class="font-semibold text-primary-600"
              >#{{ product.id }}</span
            >
          </td>
          <td>
            <div class="product-name">{{ product.name }}</div>
            <div class="product-description">{{ product.description }}</div>
          </td>
          <td>
            <span class="text-secondary-700 font-medium"
              >{{ product.categoryName }}</span
            >
          </td>
          <td>
            <div class="price-section">
              <div class="current-price">{{ product.newPrice | currency }}</div>
              <div class="old-price">{{ product.oldPrice | currency }}</div>
            </div>
          </td>
          <td>
            <div class="image-gallery">
              <img
                *ngFor="let photo of getProductPhotos(product).slice(0, 2)"
                [src]="environment.baseURL + photo.imageName"
                [alt]="product.name"
                class="product-image"
                onerror="this.style.display='none'"
              />
              <div *ngIf="getPhotosCount(product) > 2" class="image-count">
                +{{ getPhotosCount(product) - 2 }} more
              </div>
              <div *ngIf="getPhotosCount(product) === 0" class="no-images">
                No images
              </div>
            </div>
          </td>
          <td>
            <div class="action-buttons">
              <button (click)="editProductItem(product)" class="btn-edit">
                <i class="fas fa-edit mr-1"></i>
                Edit
              </button>
              <button (click)="deleteProduct(product.id)" class="btn-delete">
                <i class="fas fa-trash mr-1"></i>
                Delete
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="products.length === 0">
          <td colspan="6">
            <div class="empty-state">
              <div class="empty-icon">
                <i class="fas fa-box-open"></i>
              </div>
              <div class="empty-text">No products found</div>
              <div class="empty-subtext">
                Get started by adding your first product
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
